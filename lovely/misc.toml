[manifest]
version = "1.0.0"
dump_lua = true
priority = 1

# Force key
[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = "if _type == 'Joker' then"
position = "before"
payload = '''
if _type == 'Gemstone' then 
    forced_key = 'c_gems_ruby'
end
'''
match_indent = true

# Callback Gemstone pool to Ruby
[[patches]]
[patches.pattern]
target = "functions/common_event.lua"
pattern = '''elseif _type == 'Tag' then _pool[#_pool + 1] = "tag_handy"'''
position = "after"
payload = '''elseif _type == 'Gemstone' then _pool[#_pool + 1] = "c_gems_ruby"'''
match_indent = true

# Gemstone cards taking up 1/2 slot
[[patches]]
[patches.pattern]
target = "cardarea.lua"
pattern = "self.config.card_count = #self.cards"
position = "at"
payload = '''
if self == G.consumeables then
    self.config.card_count = 0
    
    for i = 1, #self.cards do
        local card = self.cards[i]
        if card.ability.set == "Gemstone" then
            self.config.card_count = self.config.card_count + 0.5
        else
            self.config.card_count = self.config.card_count + 1
        end
    end
else
    self.config.card_count = #self.cards
end
'''
match_indent = true